
To run the ansible playbook ssh to machine you intend to run Galaxy on. The guideline assumes you login as "ubuntu" user. The code is tested for ubuntu 20.04 LTS

on Galaxy machine:

    apt install ansible

    `apt-get install sshpass`

on Pulsar machine:

    `sudo passwd ubuntu`

    `sudo vi /etc/ssh/sshd_config`

    change `PasswordAuthentication no` To `PasswordAuthentication yes`
    `sudo service ssh restart`

on Galaxy machine:
  
    `git clone https://github.com/CEGRcode/Galaxy_Install_Ansible.git`
    
    `cd Galaxy_Install_Ansible`
    
    `ansible-playbook galaxy.yml`

    `ansible-playbook pulsar.yml --ask-pass`


Please note, in the the groupvars/all.yml file, a password needs to be used for secure communication between pulsar and Galaxy.

Current Ansible includes

Galaxy with
  CVMFS
  systemd
  slurm
  nginx
  SSL
  RabbitMQ

Pulsar with
  CVMFS
  systemd
  slurm

RabbitMQ is used for communication between Galaxy and Pulsar


Note 1:
number of CPUs in Pulsar machine needs to be updated based on specific machine configuration at:
group_vars/pulsarservers.yml

Galaxy root directory, where all the files related to Galaxy will be installed, can be changed in group_vars/galaxyservers.yml


Note 2:
 Currently there is a bug in Galaxy that Admin->Manage Allowlist cannot be updated. To overcome this issue, you can follow these steps:
A. `sudo touch /sr/galaxy/server/config/sanitize_allowlist.txt`
B. `sudo chmod 777 /sr/galaxy/server/config/sanitize_allowlist.txt`

